"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9438],{2946:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var s=n(4848),a=n(8453);const i={title:"Custom Validation"},r="Custom Validation",o={id:"schemas/custom-validation/index",title:"Custom Validation",description:"All attribute types support adding custom validation during the parsing step (see the Parser action for more details).",source:"@site/versioned_docs/version-v1/4-schemas/3-custom-validation/index.md",sourceDirName:"4-schemas/3-custom-validation",slug:"/schemas/custom-validation/",permalink:"/docs/v1/schemas/custom-validation/",draft:!1,unlisted:!1,tags:[],version:"v1",frontMatter:{title:"Custom Validation"},sidebar:"tutorialSidebar",previous:{title:"Defaults & Links",permalink:"/docs/v1/schemas/defaults-and-links/"},next:{title:"Type Inference",permalink:"/docs/v1/schemas/type-inference/"}},l={},d=[{value:"Validators",id:"validators",level:2},{value:"Recursive Schemas",id:"recursive-schemas",level:2}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components},{Details:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"custom-validation",children:"Custom Validation"})}),"\n",(0,s.jsxs)(t.p,{children:["All attribute types support adding custom validation during the ",(0,s.jsx)(t.strong,{children:"parsing step"})," (see the ",(0,s.jsx)(t.a,{href:"/docs/v1/schemas/actions/parse",children:(0,s.jsx)(t.code,{children:"Parser"})})," action for more details)."]}),"\n",(0,s.jsx)(t.p,{children:"There are three kinds of validators:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"putValidate"}),": Applied on put actions (e.g. ",(0,s.jsx)(t.a,{href:"/docs/v1/entities/actions/put-item/",children:(0,s.jsx)(t.code,{children:"PutItemCommand"})}),")"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"updateValidate"}),": Applied on update actions (e.g. ",(0,s.jsx)(t.a,{href:"/docs/v1/entities/actions/update-item/",children:(0,s.jsx)(t.code,{children:"UpdateItemCommand"})}),")"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"keyValidate"}),": Overrides other validators on key attributes (ignored otherwise)"]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"validate"})," method is a shorthand that acts as ",(0,s.jsx)(t.code,{children:"keyValidate"})," on key attributes and ",(0,s.jsx)(t.code,{children:"putValidate"})," otherwise."]}),"\n",(0,s.jsx)(t.admonition,{type:"info",children:(0,s.jsxs)(t.p,{children:["\u261d\ufe0f In order for the ",(0,s.jsx)(t.code,{children:".validate(...)"})," shorthand to work properly on key attributes, make sure to use it ",(0,s.jsx)(t.strong,{children:"after"})," calling ",(0,s.jsx)(t.code,{children:".key()"}),"."]})}),"\n",(0,s.jsx)(t.h2,{id:"validators",children:"Validators"}),"\n",(0,s.jsxs)(t.p,{children:["A custom ",(0,s.jsx)(t.strong,{children:"validator"})," is a function that takes an input (validated by the schema) and returns a ",(0,s.jsx)(t.code,{children:"boolean"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["For instance, you can make sure that a ",(0,s.jsx)(t.code,{children:"string"})," attribute has more than 3 characters like this:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:"const mySchema = schema({\n  name: string().validate(\n    // \ud83d\ude4c Types are correctly inferred!\n    name => name.length > 3\n  )\n})\n\n// \u274c Raises a `parsing.customValidationFailed` error\nmySchema.build(Parser).parse({ name: 'foo' })\n"})}),"\n",(0,s.jsxs)(t.p,{children:["In case of invalid value, you can ",(0,s.jsxs)(t.strong,{children:["return a ",(0,s.jsx)(t.code,{children:"string"})]})," to provide more context through the error message:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:"const mySchema = schema({\n  name: string().validate(name =>\n    name.length > 3 ? true : 'Provide a longer name'\n  )\n})\n\nmySchema.build(Parser).parse({ name: 'foo' })\n// => \u274c Custom validation for attribute 'name' failed with message: Provide a longer name.\n"})}),"\n",(0,s.jsx)(t.p,{children:"Finally, note that the attribute schema is also passed to the validator:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:"import type { Attribute } from 'dynamodb-toolbox/attributes'\n\nconst validator = (input: unknown, attr: Attribute) => {\n  ... // custom validation here\n}\n\nconst mySchema = schema({\n  name: string().validate(validator)\n})\n"})}),"\n",(0,s.jsx)(t.h2,{id:"recursive-schemas",children:"Recursive Schemas"}),"\n",(0,s.jsxs)(t.p,{children:["Validators are a great way to create ",(0,s.jsx)(t.strong,{children:"recursive schemas"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:"import { Parser } from 'dynamodb-toolbox/schema/actions/parse'\n\nconst isValidBulletList = (bulletList: unknown): boolean =>\n  bulletListSchema.build(Parser).validate(bulletList)\n\nconst bulletListSchema = schema({\n  title: string(),\n  subBulletList: any()\n    .optional()\n    .validate(isValidBulletList)\n})\n"})}),"\n",(0,s.jsxs)(t.admonition,{type:"note",children:[(0,s.jsxs)(t.p,{children:["Actually, you can improve the performances of this code by instanciating a single ",(0,s.jsx)(t.code,{children:"Parser"}),":"]}),(0,s.jsxs)(n,{className:"details-in-admonition",children:[(0,s.jsxs)("summary",{children:["\ud83d\udd0e ",(0,s.jsx)("b",{children:"Show code"})]}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:"let bulletListParser:\n  | Parser<typeof bulletListSchema>\n  | undefined\n\nconst isValidBulletList = (\n  bulletList: unknown\n): boolean => {\n  if (bulletListParser === undefined) {\n    bulletListParser = bulletListSchema.build(Parser)\n  }\n\n  return bulletListParser.validate(bulletList)\n}\n\nconst bulletListSchema = schema({\n  title: string(),\n  subBulletList: any()\n    .optional()\n    .validate(isValidBulletList)\n})\n"})})]})]}),"\n",(0,s.jsxs)(t.p,{children:["In those cases, type inference ",(0,s.jsx)(t.strong,{children:"only works partially"})," as the ",(0,s.jsx)(t.code,{children:"subBulletList"})," property is inferred as ",(0,s.jsx)(t.code,{children:"unknown"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["However, a ",(0,s.jsx)(t.strong,{children:"slight override"})," of the inferred types gets you there:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:"import type { FormattedValue } from 'dynamodb-toolbox/schema/actions/format'\n\n// \ud83d\ude4c Works as intended!\ntype FormattedBulletList = FormattedValue<\n  typeof bulletListSchema\n> & { subBulletList?: FormattedBulletList }\n"})})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>o});var s=n(6540);const a={},i=s.createContext(a);function r(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);